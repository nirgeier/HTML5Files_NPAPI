<!DOCTYPE html>
<!--[if lt IE 7]>
<html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>
<html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>
<html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>Nir Geier - HTML5 File API</title>

    <meta name="description" content="HTML5 File API Lecture by Nir Geier">
    <meta name="author" content="Nir Geier">
    <meta name="viewport" content="width=1024, user-scalable=no">

    <!-- Core and extension CSS files -->
    <link rel="stylesheet" href="style/custom.css">
    <link rel="stylesheet" href="deck/core/deck.core.css">
    <link rel="stylesheet" href="deck/extensions/goto/deck.goto.css">
    <link rel="stylesheet" href="deck/extensions/menu/deck.menu.css">
    <link rel="stylesheet" href="deck/extensions/navigation/deck.navigation.css">
    <link rel="stylesheet" href="deck/extensions/status/deck.status.css">
    <link rel="stylesheet" href="deck/extensions/hash/deck.hash.css">

    <!-- Theme CSS files (menu swaps these out) -->
    <link rel="stylesheet" id="style-theme-link" href="style/neon.css">
    <link rel="stylesheet" id="transition-theme-link" href="style/fade.css">

    <script src="js/modernizr.custom.js"></script>
</head>

<body class="deck-container">

<section class="slide" id="title-slide">
    <h1>Files ... </h1>
</section>

<section class="slide" id="contact">
    <div class="path">Contact details</div>
    <h2>Lecture</h2>
    <a href="https://github.com/nirgeier/W3CLecture">https://github.com/nirgeier/W3CLecture</a>
    <h2>Twitter</h2>
    @nirgeier
    <h2>Email</h2>
    nirgeier@gmail.com<br/>
</section>


<section class="slide">
    <div class="path">Agenda</div>
    <h2>Today - A short preview of files api</h2>
    <ol>
        <li class="slide">
            <h3>File API</h3>

            <p>Introduction to HTML5 file API </p>
        </li>
        <li class="slide">
            <h3>FileSystem API (sandbox filesystem)</h3>

            <p>Introduction to HTML5 fileSystem API </p>
        </li>
        <li class="slide">
            <h3>NPAPI (unlimited HD access)</h3>

            <p>Access (but don't steal ... ) any file on the client HD</p>
        </li>
    </ol>
</section>

<section class="slide">
    <h3 class="color2">File API features</h3>
    <mark>File System API extends those features.</mark>
    <ul data-list="buildUpList">
        <li>
            <mark>Import</mark>
            from the filesystem or the web.
        </li>
        <li>
            <mark>Create</mark>
            new files from scratch.
        </li>
        <li>
            <mark>Manipulate</mark>
            existing file data.
        </li>
        <li>
            <mark>Store</mark>
            file data on the client.
        </li>
        <li>
            <mark>Publish</mark>
            files back to the web.
        </li>
    </ul>
</section>
<section class="slide">
    <h3 class="color2">Local files</h3>

    The File API specification provides a <br/>
    standard way to interact with local files.

    <p class="color3">API Objects:</p>
    <ul data-list="buildUpList" class="moreItems">
        <li>
            <mark>File</mark>
            - an individual file
        </li>
        <li>
            <mark>FileList</mark>
            - an array-like sequence of File objects.
        </li>
        <li>
            <mark>Blob</mark>
            - Allows for slicing a file into byte ranges.
        </li>
        <li>
            <mark>Drag And Drop</mark>
            - build in support for files Drag And Drop<br/></li>
    </ul>

</section>

<section class="slide">
    <h3 class="color2">File Reader</h3>

    <ul data-list="buildUpList">
        <li>
            After you've obtained a
            <mark>File</mark>
            reference, instantiate a
            <mark>FileReader</mark>
            object inorder to work with the file.
        </li>
        <li>
            The
            <mark>FileReader</mark>
            used to
            <mark>asynchronously</mark>
            read the file content (into memory) using JavaScript event handling.
        </li>
        <li>It is possible to monitor the<br/>
            <mark>progress of a read</mark>
            ,
            <mark>catch errors</mark>
            ,
            and determine when a load is
            <mark>complete</mark>
            .
            In many ways the APIs resemble XMLHttpRequest's event model.
        </li>

    </ul>
</section>

<section class="slide">
    <h3 class="color2">FileReader (Methods)</h3>

    <p>FileReader includes four options for reading a file, asynchronously:</p>
    <ul data-list="buildUpList">
        <li>FileReader.
            <mark>readAsBinaryString(Blob|File)</mark>
            <br/>
            Result = the file/blob's data as a binary string (bytes 0-255).
        </li>
        <li>
            FileReader.
            <mark>readAsText(Blob|File, opt_encoding)</mark>
            <br/>
            Result = the file/blob's data as a text string. (Default encoding is UTF-8)
        </li>
        <li>
            FileReader.
            <mark>readAsDataURL(Blob|File)</mark>
            <br/>
            Result = the file/blob's data encoded as a data URL.
        </li>
        <li>
            FileReader.
            <mark>readAsArrayBuffer(Blob|File)</mark>
            <br/>
            Result = the file/blob's data as an ArrayBuffer object.
        </li>
    </ul>

</section>
<section class="slide">
    <h3 class="color2">FileReader (Events)</h3>
    <ul class="moreItems">
        <li>onloadstart</li>
        <li>onprogress</li>
        <li>onload</li>
        <li>onabort</li>
        <li>onerror</li>
        <li>onloadend</li>
    </ul>
</section>

<section class="slide">
    <h3 class="color2">Reading local files</h3>

    <p>&lt;input type=&quot;file&quot; id=&quot;...&quot; name=&quot;...&quot; multiple webkitdirectory/&gt;</p>
    <br/>
    <pre class="brush: javascript; highlight: [2,6]">
        // Add the event listener to the input type="file"
        document.querySelector('#id').addEventListener('change',
            function( e){

                // FileList object. list of the selected files
                var files = e.target.files;

                // files is a FileList of File objects. List some properties.
                var output = [];

                // Extract the information we can from the files/folder
                for (var i = 0, f; f = files[i]; i++) {
                    // f.name
                    // f.type
                    // f.size
                    // f.lastModifiedDate.toLocaleDateString()
                }
                ...
            }, false);
    </pre>
</section>

<section class="slide">
    <h3 class="color2">Reading local files (slice)</h3>

    <p>The slice method allow us to read parts of the file.</p>
    <pre class="brush: javascript; highlight:[2,12]">

    // If we use onloadend, we need to check the readyState.
    reader.onloadend = function(evt) {

        // DONE == 2
        if (evt.target.readyState === FileReader.DONE) {
            // evt.target.result;
        }
    };

    // Chrome: webkitSlice
    // FF:     mozSlice
    var blob = file.slice(start, length);
    reader.readAsBinaryString(blob);

    </pre>
</section>

<section class="slide">
    <h3 class="color2">Copy and paste</h3>

    <pre class="brush: javascript; highlight:[2,5,9,14,16]">
        // Add the paste code to the page
        document.body.onpaste = function(e) {

            // Get the reference to teh image file
            var items = e.clipboardData.items;
            for (var i = 0; i < items.length; ++i) {

                // Verify that we have  a png file
                if (items[i].kind == 'file' && items[i].type == 'image/png') {

                    var img = document.createElement('img');

                    // Get the file data
                    var blob = items[i].getAsFile();
                    // Set the image src
                    img.src = window.webkitURL.createObjectURL(blob);

                    document.body.appendChild(img);
                }
            }
        };


    </pre>
</section>

<section class="slide">
    <h3 class="color2">Monitoring the progress of a read</h3>

    <p> One of the nice things that we get for free when using
        <mark>async</mark>
        event handling
        is the ability to
        <mark>monitor the progress</mark>
        of the file read; useful for large files,
        catching errors,
        and figuring out when a read is complete.
        <br/>
        The
        <mark>onloadstart</mark>
        and
        <mark>onprogress</mark>
        events can be used
        to monitor the progress of a read.
    </p>
    <span data-list="hidden">
    <pre class="brush: javascript; highlight: [6,8,13]">
    // store the progress percent
    var percentLoaded;

    // evt is an ProgressEvent.
    function updateProgress(evt) {
        if (evt.lengthComputable) {
          // calculate the progress in %
          var percentLoaded = Math.round((evt.loaded / evt.total) * 100);
        }
      }

    // reader = FileReader, register the progress event
    reader.onprogress = updateProgress;
    </pre>
</span>
</section>
<section class="slide">
    <div class="path">File API &raquo; Demos</div>
    <h2>Demos</h2>

    <ol>
        <li>
            <h3><a href="demos/05-CopyPaste/05-CopyPaste.html" target="_blank">Input type=file</a></h3>
        </li>
        <li class="slide">
            <h3><a href="demos/05-CopyPaste/05-CopyPaste.html" target="_blank">Input type=file</a></h3>
        </li>
        <li class="slide">
        </li>
    </ol>
</section>



<p class="deck-status">
    <span class="deck-status-current"></span>
    /
    <span class="deck-status-total"></span>
</p>

<footer>
    <img src="images/bug.png" id="footerBug">

    <div class="name">Nir Geier</div>
    <div> - HTML5 File API / File System API / NPAPI</div>
</footer>

<script src="js/jquery-1.7.min.js"></script>

<!-- Deck Core and extensions -->
<script src="deck/core/deck.core.js"></script>
<script src="deck/extensions/hash/deck.hash.js"></script>
<script src="deck/extensions/menu/deck.menu.js"></script>
<script src="deck/extensions/goto/deck.goto.js"></script>
<script src="deck/extensions/status/deck.status.js"></script>
<script src="deck/extensions/navigation/deck.navigation.js"></script>

<!-- Specific to this page -->
<script>
    $(function() {
        // Deck initialization
        $.deck('.slide');
    });
</script>
</body>
</html>
